/**
 * angular-drag-and-drop-lists v2.1.1
 *
 * Copyright (c) 2014 Marcel Juenemann marcel@juenemann.cc
 * Copyright (c) 2014-2017 Google Inc.
 * https://github.com/marceljuenemann/angular-drag-and-drop-lists
 *
 * License: MIT
 */
!function(e){function n(e,n){return"all"==n?e:e.filter(function(e){return-1!=n.toLowerCase().indexOf(e)})}var a="application/x-dnd",t="application/json",r="Text",d=["move","copy","link"]
e.directive("dndDraggable",["$parse","$timeout",function(e,i){return function(l,f,c){f.attr("draggable","true"),c.dndDisableIf&&l.$watch(c.dndDisableIf,function(e){f.attr("draggable",!e)}),f.on("dragstart",function(g){if(g=g.originalEvent||g,"false"==f.attr("draggable"))return!0
o.isDragging=!0,o.itemType=c.dndType&&l.$eval(c.dndType).toLowerCase(),o.dropEffect="none",o.effectAllowed=c.dndEffectAllowed||d[0],g.dataTransfer.effectAllowed=o.effectAllowed
var s=l.$eval(c.dndDraggable),u=a+(o.itemType?"-"+o.itemType:"")
try{g.dataTransfer.setData(u,angular.toJson(s))}catch(e){var p=angular.toJson({item:s,type:o.itemType})
try{g.dataTransfer.setData(t,p)}catch(e){var v=n(d,o.effectAllowed)
g.dataTransfer.effectAllowed=v[0],g.dataTransfer.setData(r,p)}}f.addClass("dndDragging"),i(function(){f.addClass("dndDraggingSource")},0)
var D=g.target.getBoundingClientRect(),y=g.clientX-D.left,T=g.clientY-D.top
if(g._dndHandle&&g.dataTransfer.setDragImage&&g.dataTransfer.setDragImage(f[0],y,T),e(c.dndDragstart)(l,{event:g}),c.dndCallback){var h=e(c.dndCallback)
o.callback=function(e){return h(l,e||{})}}g.stopPropagation()}),f.on("dragend",function(n){n=n.originalEvent||n,l.$apply(function(){var a=o.dropEffect
e(c[{copy:"dndCopied",link:"dndLinked",move:"dndMoved",none:"dndCanceled"}[a]])(l,{event:n}),e(c.dndDragend)(l,{event:n,dropEffect:a})}),o.isDragging=!1,o.callback=void 0,f.removeClass("dndDragging"),f.removeClass("dndDraggingSource"),n.stopPropagation(),i(function(){f.removeClass("dndDraggingSource")},0)}),f.on("click",function(n){c.dndSelected&&(n=n.originalEvent||n,l.$apply(function(){e(c.dndSelected)(l,{event:n})}),n.stopPropagation())}),f.on("selectstart",function(){this.dragDrop&&this.dragDrop()})}}]),e.directive("dndList",["$parse",function(e){return function(i,l,f){function c(e){if(!e)return r
for(var n=0;n<e.length;n++)if(e[n]==r||e[n]==t||e[n].substr(0,a.length)==a)return e[n]
return null}function g(e){return o.isDragging?o.itemType||void 0:e==r||e==t?null:e&&e.substr(a.length+1)||void 0}function s(e){return!m.disabled&&(!(!m.externalSources&&!o.isDragging)&&(!m.allowedTypes||null===e||e&&-1!=m.allowedTypes.indexOf(e)))}function u(e,a){var t=d
return a||(t=n(t,e.dataTransfer.effectAllowed)),o.isDragging&&(t=n(t,o.effectAllowed)),f.dndEffectAllowed&&(t=n(t,f.dndEffectAllowed)),t.length?e.ctrlKey&&-1!=t.indexOf("copy")?"copy":e.altKey&&-1!=t.indexOf("link")?"link":t[0]:"none"}function p(){return y.remove(),l.removeClass("dndDragover"),!0}function v(n,a,t,r,d,l){return e(n)(i,{callback:o.callback,dropEffect:t,event:a,external:!o.isDragging,index:void 0!==d?d:D(),item:l||void 0,type:r})}function D(){return Array.prototype.indexOf.call(h.children,T)}var y=function(){var e
return angular.forEach(l.children(),function(n){var a=angular.element(n)
a.hasClass("dndPlaceholder")&&(e=a)}),e||angular.element("<li class='dndPlaceholder'></li>")}()
y.remove()
var T=y[0],h=l[0],m={}
l.on("dragenter",function(e){e=e.originalEvent||e
var n=f.dndAllowedTypes&&i.$eval(f.dndAllowedTypes)
m={allowedTypes:angular.isArray(n)&&n.join("|").toLowerCase().split("|"),disabled:f.dndDisableIf&&i.$eval(f.dndDisableIf),externalSources:f.dndExternalSources&&i.$eval(f.dndExternalSources),horizontal:f.dndHorizontalList&&i.$eval(f.dndHorizontalList)}
var a=c(e.dataTransfer.types)
if(!a||!s(g(a)))return!0
e.preventDefault()}),l.on("dragover",function(e){e=e.originalEvent||e
var n=c(e.dataTransfer.types),a=g(n)
if(!n||!s(a))return!0
if(T.parentNode!=h&&l.append(y),e.target!=h){for(var t=e.target;t.parentNode!=h&&t.parentNode;)t=t.parentNode
if(t.parentNode==h&&t!=T){var d=t.getBoundingClientRect()
if(m.horizontal)var o=e.clientX<d.left+d.width/2
else var o=e.clientY<d.top+d.height/2
h.insertBefore(T,o?t:t.nextSibling)}}var i=n==r,D=u(e,i)
return"none"==D?p():f.dndDragover&&!v(f.dndDragover,e,D,a)?p():(e.preventDefault(),i||(e.dataTransfer.dropEffect=D),l.addClass("dndDragover"),e.stopPropagation(),!1)}),l.on("drop",function(e){e=e.originalEvent||e
var n=c(e.dataTransfer.types),a=g(n)
if(!n||!s(a))return!0
e.preventDefault()
try{var d=JSON.parse(e.dataTransfer.getData(n))}catch(e){return p()}if((n==r||n==t)&&(a=d.type||void 0,d=d.item,!s(a)))return p()
var l=n==r,y=u(e,l)
if("none"==y)return p()
var T=D()
return f.dndDrop&&!(d=v(f.dndDrop,e,y,a,T,d))?p():(o.dropEffect=y,l||(e.dataTransfer.dropEffect=y),!0!==d&&i.$apply(function(){i.$eval(f.dndList).splice(T,0,d)}),v(f.dndInserted,e,y,a,T,d),p(),e.stopPropagation(),!1)}),l.on("dragleave",function(e){e=e.originalEvent||e
var n=document.elementFromPoint(e.clientX,e.clientY)
h.contains(n)&&!e._dndPhShown?e._dndPhShown=!0:p()})}}]),e.directive("dndNodrag",function(){return function(e,n,a){n.attr("draggable","true"),n.on("dragstart",function(e){e=e.originalEvent||e,e._dndHandle||(e.dataTransfer.types&&e.dataTransfer.types.length||e.preventDefault(),e.stopPropagation())}),n.on("dragend",function(e){e=e.originalEvent||e,e._dndHandle||e.stopPropagation()})}}),e.directive("dndHandle",function(){return function(e,n,a){n.attr("draggable","true"),n.on("dragstart dragend",function(e){e=e.originalEvent||e,e._dndHandle=!0})}})
var o={}}(angular.module("dndLists",[]))
